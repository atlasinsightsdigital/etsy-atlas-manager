{
  "entities": {
    "Order": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Order",
      "type": "object",
      "description": "Represents an order placed through Etsy.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Order entity."
        },
        "etsyOrderId": {
          "type": "string",
          "description": "The order ID as it exists on Etsy."
        },
        "orderPrice": {
          "type": "number",
          "description": "The total price of the order."
        },
        "orderCost": {
          "type": "number",
          "description": "The cost of goods for the order."
        },
        "shippingCost": {
          "type": "number",
          "description": "The shipping cost associated with the order."
        },
        "additionalFees": {
          "type": "number",
          "description": "Any additional fees associated with the order."
        },
        "status": {
          "type": "string",
          "description": "The current status of the order (e.g., 'pending', 'shipped', 'delivered')."
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N Order)"
        }
      },
      "required": [
        "id",
        "etsyOrderId",
        "orderPrice",
        "orderCost",
        "shippingCost",
        "additionalFees",
        "status",
        "productId"
      ]
    },
    "Product": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Product",
      "type": "object",
      "description": "Represents a product listed in the Etsy store.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Product entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the product."
        },
        "description": {
          "type": "string",
          "description": "A detailed description of the product."
        },
        "price": {
          "type": "number",
          "description": "The price of the product."
        },
        "sku": {
          "type": "string",
          "description": "The stock keeping unit (SKU) for the product."
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "price",
        "sku"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}/products/{productId}",
        "definition": {
          "entityName": "Product",
          "schema": {
            "$ref": "#/backend/entities/Product"
          },
          "description": "Stores product data for each user. Path-based ownership ensures only the owner can manage the product.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "productId",
              "description": "The unique identifier of the product."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/products/{productId}/orders/{orderId}",
        "definition": {
          "entityName": "Order",
          "schema": {
            "$ref": "#/backend/entities/Order"
          },
          "description": "Stores order data for each product, owned by a specific user. Includes denormalized product information (name, price) for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "productId",
              "description": "The unique identifier of the product."
            },
            {
              "name": "orderId",
              "description": "The unique identifier of the order."
            }
          ]
        }
      }
    ],
    "reasoning": "This Firestore structure is designed to support the Etsy Atlas Manager application, focusing on secure and scalable data management for products and orders. The design prioritizes authorization independence and clear security rules by leveraging path-based ownership for product data and denormalization for order access control. The structure incorporates Structural Segregation, Access Modeling, and Data Clarity principles to ensure a robust and maintainable system.\n\nProducts are stored under `/users/{userId}/products/{productId}`, establishing clear ownership and simplifying security rules. Orders are stored under `/users/{userId}/products/{productId}/orders/{orderId}`, further solidifying the relationship and enabling efficient querying. The denormalization strategy involves copying relevant product information into each order document to eliminate the need for `get()` calls in security rules. This approach ensures that authorization checks for orders can be performed independently, without relying on parent document data.\n\nQAPs are supported via structural segregation. Product and order data are stored under specific user paths. This structure supports secure `list` operations by ensuring that users can only access product and order data related to them. Additionally, the membership map pattern can be implemented for collaborative features, if needed in the future."
  }
}